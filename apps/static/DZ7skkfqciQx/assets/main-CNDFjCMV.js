(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function s(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(i){if(i.ep)return;i.ep=!0;const o=s(i);fetch(i.href,o)}})();let r={isRunning:!1,startTime:null,elapsedTime:0,currentMode:"ready"},e={iceSpeed:5,shots:[],speedHistory:[],currentView:"main",adjustingPosition:!1};async function m(t,n){if(window.creationStorage)try{const s=btoa(JSON.stringify(n));await window.creationStorage.plain.setItem(t,s)}catch(s){console.error("Error saving to storage:",s)}else localStorage.setItem(t,JSON.stringify(n))}async function g(t){if(window.creationStorage)try{const n=await window.creationStorage.plain.getItem(t);if(n)return JSON.parse(atob(n))}catch(n){console.error("Error loading from storage:",n)}else{const n=localStorage.getItem(t);if(n)return JSON.parse(n)}return null}async function I(){const t=await g("curling_shots"),n=await g("curling_speed_history"),s=await g("curling_ice_speed");t&&(e.shots=t),n&&(e.speedHistory=n),s&&(e.iceSpeed=s),E()}async function p(){await m("curling_shots",e.shots),await m("curling_speed_history",e.speedHistory),await m("curling_ice_speed",e.iceSpeed)}function L(){r.isRunning||(r.isRunning=!0,r.startTime=Date.now(),r.currentMode="timing",u(),x(),r.interval=setInterval(()=>{r.elapsedTime=(Date.now()-r.startTime)/1e3,u()},10))}function M(){if(!r.isRunning)return;clearInterval(r.interval),r.isRunning=!1,r.currentMode="stopped";const t=r.elapsedTime,n=P(t,e.iceSpeed);h(n),e.adjustingPosition=!0,e.currentStonePosition=n,e.currentShotTime=t,u(),w(t,e.iceSpeed)}function f(){clearInterval(r.interval),r.isRunning=!1,r.startTime=null,r.elapsedTime=0,r.currentMode="ready",e.adjustingPosition=!1,u(),B(),D()}function P(t,n){const s=n/10,i=Math.max(0,Math.min(1,(t-2)/4))*100*(.5+s*.5);return Math.max(0,Math.min(100,i))}function H(t){return t<35?"guard":t<75?"normal":"takeout"}function u(){const t=document.getElementById("timerValue"),n=document.getElementById("timerStatus"),s=document.querySelector(".timer-display");t.textContent=r.elapsedTime.toFixed(2)+"s",r.currentMode==="timing"?(n.textContent="Timing... Press to stop",s.classList.add("running")):r.currentMode==="stopped"?(n.textContent="Adjust position with scroll wheel",s.classList.remove("running")):(n.textContent="Press side button to start",s.classList.remove("running"))}function h(t){const n=document.getElementById("stoneIndicator"),s=30+t/100*240;n.setAttribute("cy",s),n.setAttribute("opacity","1")}function B(){document.getElementById("stoneIndicator").setAttribute("opacity","0")}function x(){const t=document.getElementById("stoneIndicator");t.setAttribute("cy","30"),t.setAttribute("opacity","1")}function y(){const t=document.getElementById("speedValue");t.textContent=e.iceSpeed}function w(t,n,s){const a=document.getElementById("recText"),i=document.getElementById("sweepingRec");let o="",c="";t<3.5?(o="HEAVY SWEEP NEEDED - Stone is short",c="heavy"):t<4.2?(o="Moderate sweep - Stone slightly short",c="medium"):t<5?(o="Light sweep - Good weight",c="light"):t<5.5?(o="Minimal sweep - Stone is heavy",c="light"):(o="NO SWEEP - Stone too heavy",c="heavy"),n<4?o+=" (Slow ice)":n>7&&(o+=" (Fast ice)"),a.textContent=o,i.className="sweeping-rec "+c}function D(){const t=document.getElementById("recText"),n=document.getElementById("sweepingRec");t.textContent="-",n.className="sweeping-rec"}function v(){const t=document.getElementById("shotList");if(e.shots.length===0){t.innerHTML='<div class="empty-state">No shots recorded yet</div>';return}t.innerHTML="";for(let n=e.shots.length-1;n>=0;n--){const s=e.shots[n],a=document.createElement("div");a.className="shot-item",a.innerHTML=`
      <span class="shot-number">Shot ${s.number}</span>
      <span class="shot-time">${s.time.toFixed(2)}s</span>
      <span class="shot-type ${s.type}">${s.type.toUpperCase()}</span>
    `,t.appendChild(a)}}function A(t,n,s){const a=H(n),i=e.shots.length%8+1;e.shots.length>=8&&e.shots.shift(),e.shots.push({number:i,time:t,position:n,type:a,iceSpeed:s,timestamp:Date.now()}),e.speedHistory.push({iceSpeed:s,timestamp:Date.now()}),e.speedHistory.length>50&&e.speedHistory.shift(),p(),v(),S()}function N(){document.getElementById("mainView").classList.add("hidden"),document.getElementById("settingsView").classList.remove("hidden"),e.currentView="settings",S()}function b(){document.getElementById("settingsView").classList.add("hidden"),document.getElementById("mainView").classList.remove("hidden"),e.currentView="main"}function S(){C(),V()}function C(){const t=document.getElementById("speedHistory");if(e.speedHistory.length===0){t.innerHTML='<div class="empty-state">No ice speed data yet</div>';return}const n=e.speedHistory.slice(-10).reverse();t.innerHTML="",n.forEach((s,a)=>{const o=new Date(s.timestamp).toLocaleTimeString(),c=document.createElement("div");c.className="speed-item",c.innerHTML=`
      <span>${o}</span>
      <span>Speed: ${s.iceSpeed}/10</span>
    `,t.appendChild(c)})}function V(){const t=document.getElementById("avgTimes");if(e.shots.length===0){t.innerHTML='<div class="empty-state">No shots recorded yet</div>';return}const n=e.shots.filter(d=>d.type==="guard"),s=e.shots.filter(d=>d.type==="normal"),a=e.shots.filter(d=>d.type==="takeout"),i=n.length>0?n.reduce((d,l)=>d+l.time,0)/n.length:0,o=s.length>0?s.reduce((d,l)=>d+l.time,0)/s.length:0,c=a.length>0?a.reduce((d,l)=>d+l.time,0)/a.length:0,T=e.shots.reduce((d,l)=>d+l.time,0)/e.shots.length;t.innerHTML=`
    <div class="avg-item">
      <span>Overall Average:</span>
      <span>${T.toFixed(2)}s</span>
    </div>
    ${n.length>0?`
    <div class="avg-item">
      <span>Guard Average:</span>
      <span>${i.toFixed(2)}s (${n.length})</span>
    </div>
    `:""}
    ${s.length>0?`
    <div class="avg-item">
      <span>Normal Average:</span>
      <span>${o.toFixed(2)}s (${s.length})</span>
    </div>
    `:""}
    ${a.length>0?`
    <div class="avg-item">
      <span>Takeout Average:</span>
      <span>${c.toFixed(2)}s (${a.length})</span>
    </div>
    `:""}
  `}function $(){confirm("Reset all curling data? This cannot be undone.")&&(e.shots=[],e.speedHistory=[],e.iceSpeed=5,p(),f(),E(),S())}function E(){u(),y(),v()}window.addEventListener("scrollUp",()=>{e.currentView!=="settings"&&(e.adjustingPosition?(e.currentStonePosition=Math.min(100,e.currentStonePosition+5),h(e.currentStonePosition),w(e.currentShotTime,e.iceSpeed)):(e.iceSpeed=Math.min(10,e.iceSpeed+1),y(),p()))});window.addEventListener("scrollDown",()=>{e.currentView!=="settings"&&(e.adjustingPosition?(e.currentStonePosition=Math.max(0,e.currentStonePosition-5),h(e.currentStonePosition),w(e.currentShotTime,e.iceSpeed)):(e.iceSpeed=Math.max(1,e.iceSpeed-1),y(),p()))});window.addEventListener("sideClick",()=>{e.currentView!=="settings"&&(e.adjustingPosition?(A(e.currentShotTime,e.currentStonePosition,e.iceSpeed),f()):r.currentMode==="ready"?L():r.currentMode==="timing"?M():r.currentMode==="stopped"&&f())});document.addEventListener("DOMContentLoaded",()=>{document.getElementById("menuBtn").addEventListener("click",()=>{N()}),document.getElementById("backBtn").addEventListener("click",()=>{b()}),document.getElementById("resetBtn").addEventListener("click",()=>{$()}),typeof PluginMessageHandler>"u"&&window.addEventListener("keydown",t=>{t.code==="Space"?(t.preventDefault(),window.dispatchEvent(new CustomEvent("sideClick"))):t.code==="ArrowUp"?(t.preventDefault(),window.dispatchEvent(new CustomEvent("scrollUp"))):t.code==="ArrowDown"&&(t.preventDefault(),window.dispatchEvent(new CustomEvent("scrollDown")))}),I(),console.log("Curling Timer initialized!")});
